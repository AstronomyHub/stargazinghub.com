<div id="lang-toast" class="fixed bottom-4 inset-x-4 z-[100] md:left-1/2 md:right-auto md:-translate-x-1/2 md:w-full md:max-w-md hidden">
  <div class="glass p-3 rounded-2xl shadow-2xl border border-[var(--hydrogen-pink)]/30 animate-reveal-up backdrop-blur-xl bg-[#030014]/90">
    <div class="flex flex-col gap-3">
      
      <!-- Top: Icon + Text -->
      <div class="flex items-center gap-3">
        <span class="text-xl shrink-0">ğŸŒ</span>
        <div class="flex-1 min-w-0">
          <p class="font-bold text-white text-sm leading-tight mb-0.5" id="lang-toast-title">Change Language?</p>
          <p class="text-[var(--text-secondary)] text-[11px] leading-tight break-words" id="lang-toast-message">Switch to your local language</p>
        </div>
      </div>

      <!-- Bottom: Buttons (Full Width) -->
      <div class="grid grid-cols-2 gap-2 w-full">
        <button id="lang-toast-close" class="py-2 px-2 rounded-xl bg-white/5 hover:bg-white/10 text-[var(--text-secondary)] text-xs font-medium transition-colors border border-white/10 text-center truncate">
          Dismiss
        </button>
        <button id="lang-toast-confirm" class="py-2 px-2 bg-[var(--hydrogen-pink)] hover:bg-[var(--hydrogen-pink)]/90 text-white text-xs font-bold rounded-xl transition-colors shadow-lg shadow-pink-500/20 text-center truncate">
          Switch
        </button>
      </div>

    </div>
  </div>
</div>

<style>
  @keyframes reveal-up {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  .animate-reveal-up {
    animation: reveal-up 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
  }
</style>

<script is:inline>
  (function() {
    // Only run on root path (English homepage)
    if (window.location.pathname !== '/' && window.location.pathname !== '/index.html') return;

    // 1. Check if user dismissed it before
    if (localStorage.getItem('lang_toast_dismissed')) return;

    // 2. Check browser language
    var userLang = navigator.language || navigator.userLanguage; 
    if (!userLang) return;
    userLang = userLang.toLowerCase();

    // Language mapping & UI Text
    var langConfig = {
      'zh': { url: '/zh/', name: 'åˆ‡æ¢ (Switch)', title: 'å»ºè®®åˆ‡æ¢è¯­è¨€', msg: 'æ£€æµ‹åˆ°æ‚¨çš„æµè§ˆå™¨ä¸ºä¸­æ–‡ï¼Œæ˜¯å¦åˆ‡æ¢ï¼Ÿ' },
      'zh-cn': { url: '/zh/', name: 'åˆ‡æ¢ (Switch)', title: 'å»ºè®®åˆ‡æ¢è¯­è¨€', msg: 'æ£€æµ‹åˆ°æ‚¨çš„æµè§ˆå™¨ä¸ºä¸­æ–‡ï¼Œæ˜¯å¦åˆ‡æ¢ï¼Ÿ' },
      'zh-sg': { url: '/zh/', name: 'åˆ‡æ¢ (Switch)', title: 'å»ºè®®åˆ‡æ¢è¯­è¨€', msg: 'æ£€æµ‹åˆ°æ‚¨çš„æµè§ˆå™¨ä¸ºä¸­æ–‡ï¼Œæ˜¯å¦åˆ‡æ¢ï¼Ÿ' },
      'zh-tw': { url: '/zh-tw/', name: 'åˆ‡æ› (Switch)', title: 'å»ºè­°åˆ‡æ›èªè¨€', msg: 'æª¢æ¸¬åˆ°æ‚¨çš„ç€è¦½å™¨ç‚ºä¸­æ–‡ï¼Œæ˜¯å¦åˆ‡æ›ï¼Ÿ' },
      'zh-hk': { url: '/zh-tw/', name: 'åˆ‡æ› (Switch)', title: 'å»ºè­°åˆ‡æ›èªè¨€', msg: 'æª¢æ¸¬åˆ°æ‚¨çš„ç€è¦½å™¨ç‚ºä¸­æ–‡ï¼Œæ˜¯å¦åˆ‡æ›ï¼Ÿ' },
      'zh-mo': { url: '/zh-tw/', name: 'åˆ‡æ› (Switch)', title: 'å»ºè­°åˆ‡æ›èªè¨€', msg: 'æª¢æ¸¬åˆ°æ‚¨çš„ç€è¦½å™¨ç‚ºä¸­æ–‡ï¼Œæ˜¯å¦åˆ‡æ›ï¼Ÿ' },
      'de': { url: '/de/', name: 'Wechseln', title: 'Sprache Ã¤ndern?', msg: 'MÃ¶chten Sie zu Deutsch wechseln?' },
      'ja': { url: '/ja/', name: 'åˆ‡ã‚Šæ›¿ãˆ', title: 'è¨€èªè¨­å®š', msg: 'æ—¥æœ¬èªã‚µã‚¤ãƒˆã«åˆ‡ã‚Šæ›¿ãˆã¾ã™ã‹ï¼Ÿ' },
      'ko': { url: '/ko/', name: 'ì „í™˜', title: 'ì–¸ì–´ ë³€ê²½', msg: 'í•œêµ­ì–´ ì‚¬ì´íŠ¸ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?' },
      'fr': { url: '/fr/', name: 'Changer', title: 'Langue dÃ©tectÃ©e', msg: 'Voulez-vous passer en franÃ§ais ?' },
      'es': { url: '/es/', name: 'Cambiar', title: 'Idioma detectado', msg: 'Â¿Cambiar a espaÃ±ol?' },
      'it': { url: '/it/', name: 'Cambia', title: 'Lingua rilevata', msg: 'Passare all\'italiano?' },
      'ru': { url: '/ru/', name: 'ĞŸĞµÑ€ĞµĞ¹Ñ‚Ğ¸', title: 'Ğ¡Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ÑĞ·Ñ‹Ğº', msg: 'ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒÑÑ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¸Ğ¹?' },
      'nl': { url: '/nl/', name: 'Wissel', title: 'Taal wijzigen', msg: 'Wissel naar Nederlands?' },
      'pl': { url: '/pl/', name: 'ZmieÅ„', title: 'ZmieÅ„ jÄ™zyk', msg: 'PrzeÅ‚Ä…cz na polski?' }
    };

    // Try match
    var target = langConfig[userLang];
    if (!target) {
      var mainLang = userLang.split('-')[0];
      target = langConfig[mainLang];
    }

    // If target found and it's NOT English (since we are on English page)
    if (target && !userLang.startsWith('en')) {
      var toast = document.getElementById('lang-toast');
      var titleEl = document.getElementById('lang-toast-title');
      var msgEl = document.getElementById('lang-toast-message');
      var confirmBtn = document.getElementById('lang-toast-confirm');
      var closeBtn = document.getElementById('lang-toast-close');

      if (toast && titleEl && msgEl && confirmBtn && closeBtn) {
        // Update UI
        titleEl.textContent = target.title;
        msgEl.textContent = target.msg;
        confirmBtn.textContent = target.name;

        // Show toast
        toast.classList.remove('hidden');

        // Handlers
        confirmBtn.onclick = function() {
          localStorage.setItem('preferred_path', target.url);
          window.location.href = target.url;
        };

        closeBtn.onclick = function() {
          toast.classList.add('hidden');
          localStorage.setItem('lang_toast_dismissed', 'true');
        };
      }
    }
  })();
</script>
