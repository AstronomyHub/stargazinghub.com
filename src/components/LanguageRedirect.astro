<div id="lang-toast" class="fixed bottom-24 left-1/2 -translate-x-1/2 z-50 w-[90%] max-w-md hidden">
  <div class="glass p-4 rounded-xl shadow-2xl border border-[var(--hydrogen-pink)]/30 flex items-center justify-between gap-4 animate-reveal">
    <div class="flex items-center gap-3">
      <span class="text-2xl">ğŸŒ</span>
      <div class="text-sm">
        <p class="font-bold text-white mb-0.5" id="lang-toast-title">Change Language?</p>
        <p class="text-[var(--text-secondary)] text-xs" id="lang-toast-message">Switch to your local language</p>
      </div>
    </div>
    <div class="flex gap-2">
      <button id="lang-toast-close" class="p-2 rounded-lg hover:bg-white/10 text-[var(--text-secondary)] transition-colors">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
      </button>
      <button id="lang-toast-confirm" class="px-4 py-2 bg-[var(--hydrogen-pink)] hover:bg-[var(--hydrogen-pink)]/90 text-white text-sm font-bold rounded-lg transition-colors shadow-lg shadow-pink-500/20">
        Switch
      </button>
    </div>
  </div>
</div>

<script is:inline>
  (function() {
    // Only run on root path (English homepage)
    if (window.location.pathname !== '/' && window.location.pathname !== '/index.html') return;

    // 1. Check if user dismissed it before
    if (localStorage.getItem('lang_toast_dismissed')) return;

    // 2. Check browser language
    var userLang = navigator.language || navigator.userLanguage; 
    if (!userLang) return;
    userLang = userLang.toLowerCase();

    // Language mapping & UI Text
    var langConfig = {
      'zh': { url: '/zh/', name: 'ç®€ä½“ä¸­æ–‡', title: 'åˆ‡æ¢è¯­è¨€ï¼Ÿ', msg: 'æ£€æµ‹åˆ°æ‚¨çš„æµè§ˆå™¨è¯­è¨€ä¸ºä¸­æ–‡' },
      'zh-cn': { url: '/zh/', name: 'ç®€ä½“ä¸­æ–‡', title: 'åˆ‡æ¢è¯­è¨€ï¼Ÿ', msg: 'æ£€æµ‹åˆ°æ‚¨çš„æµè§ˆå™¨è¯­è¨€ä¸ºä¸­æ–‡' },
      'zh-sg': { url: '/zh/', name: 'ç®€ä½“ä¸­æ–‡', title: 'åˆ‡æ¢è¯­è¨€ï¼Ÿ', msg: 'æ£€æµ‹åˆ°æ‚¨çš„æµè§ˆå™¨è¯­è¨€ä¸ºä¸­æ–‡' },
      'zh-tw': { url: '/zh-tw/', name: 'ç¹é«”ä¸­æ–‡', title: 'åˆ‡æ›èªè¨€ï¼Ÿ', msg: 'æª¢æ¸¬åˆ°æ‚¨çš„ç€è¦½å™¨èªè¨€ç‚ºä¸­æ–‡' },
      'zh-hk': { url: '/zh-tw/', name: 'ç¹é«”ä¸­æ–‡', title: 'åˆ‡æ›èªè¨€ï¼Ÿ', msg: 'æª¢æ¸¬åˆ°æ‚¨çš„ç€è¦½å™¨èªè¨€ç‚ºä¸­æ–‡' },
      'zh-mo': { url: '/zh-tw/', name: 'ç¹é«”ä¸­æ–‡', title: 'åˆ‡æ›èªè¨€ï¼Ÿ', msg: 'æª¢æ¸¬åˆ°æ‚¨çš„ç€è¦½å™¨èªè¨€ç‚ºä¸­æ–‡' },
      'de': { url: '/de/', name: 'Deutsch', title: 'Sprache Ã¤ndern?', msg: 'Zu Deutsch wechseln' },
      'ja': { url: '/ja/', name: 'æ—¥æœ¬èª', title: 'è¨€èªã‚’å¤‰æ›´ï¼Ÿ', msg: 'æ—¥æœ¬èªã«åˆ‡ã‚Šæ›¿ãˆã‚‹' },
      'ko': { url: '/ko/', name: 'í•œêµ­ì–´', title: 'ì–¸ì–´ ë³€ê²½?', msg: 'í•œêµ­ì–´ë¡œ ì „í™˜' },
      'fr': { url: '/fr/', name: 'FranÃ§ais', title: 'Changer de langue?', msg: 'Passer au franÃ§ais' },
      'es': { url: '/es/', name: 'EspaÃ±ol', title: 'Â¿Cambiar idioma?', msg: 'Cambiar a espaÃ±ol' },
      'it': { url: '/it/', name: 'Italiano', title: 'Cambia lingua?', msg: 'Passa all\'italiano' },
      'ru': { url: '/ru/', name: 'Ğ ÑƒÑÑĞºĞ¸Ğ¹', title: 'Ğ¡Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ÑĞ·Ñ‹Ğº?', msg: 'ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒÑÑ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¸Ğ¹' },
      'nl': { url: '/nl/', name: 'Nederlands', title: 'Taal wijzigen?', msg: 'Wissel naar Nederlands' },
      'pl': { url: '/pl/', name: 'Polski', title: 'ZmieÅ„ jÄ™zyk?', msg: 'PrzeÅ‚Ä…cz na polski' }
    };

    // Try match
    var target = langConfig[userLang];
    if (!target) {
      var mainLang = userLang.split('-')[0];
      target = langConfig[mainLang];
    }

    // If target found and it's NOT English (since we are on English page)
    if (target && !userLang.startsWith('en')) {
      var toast = document.getElementById('lang-toast');
      var titleEl = document.getElementById('lang-toast-title');
      var msgEl = document.getElementById('lang-toast-message');
      var confirmBtn = document.getElementById('lang-toast-confirm');
      var closeBtn = document.getElementById('lang-toast-close');

      if (toast && titleEl && msgEl && confirmBtn && closeBtn) {
        // Update UI
        titleEl.textContent = target.title;
        msgEl.textContent = target.msg;
        confirmBtn.textContent = target.name;

        // Show toast
        toast.classList.remove('hidden');

        // Handlers
        confirmBtn.onclick = function() {
          localStorage.setItem('preferred_path', target.url);
          window.location.href = target.url;
        };

        closeBtn.onclick = function() {
          toast.classList.add('hidden');
          localStorage.setItem('lang_toast_dismissed', 'true');
        };
      }
    }
  })();
</script>
